<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 10초만에 세계여행 가는 상상 </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/index.css" rel="stylesheet">
</head>
<body>
    <form id = "indexForm">
        <article class="comic">
            <div class="panel">
                <input type = "text" class = "city" name = "city" placeholder="가고 싶은 도시명은?">
                <br>
                <input type = "number" class = "numberOfDays" name = "numberOfDays" placeholder="몇 일 여행이 될까요?">
                <br>
                <button id = "goTravle" type = "submit"> 자 이제 떠나볼까? </button>    
            </div>            
        </article>
        
        <!-- 위 폼의 경우, Enter로 버튼을 누르는 기능을 추가하기 위해 submit 유형을 추가함 -->
        <!-- city / numberOfDays 를 fetch 로 GPT의 데이터를 받아오고 -->
        <!-- Loading 화면 중, GPT의 처리와 Parsing 등을 전부 진행함으로서 처리 대기 시간을 확보 -->
        
    </form>

    <div class = "loadingScreen">
        <!-- 로딩 스크린용 암막 구성 -->
        


    </div>

    <img src = './image/airplane.png' class = 'airplane'> // 

    <div style = "background;">

    </div>

    <script>
        var goTravle = document.querySelector('#goTravle')
        var systemContents = ''
        var contents = ''
        var $tempCity = ''
        var $city = document.querySelector('.city');
        var $numberOfDays = document.querySelector('.numberOfDays');
        const url = `https://estsoft-openai-api.jejucodingcamp.workers.dev/`;
        var data = [];
        // GPT의 질문에 사용될 질문 설정
        
        data.push({
                
        })

        // 이벤트 리스너 발동 시 json 작성 및 fetch 수행
        goTravle.addEventListener('click', e => {
            e.preventDefault()
            // 입력 값을 활용하여 질문 생성 
            systemContents = "입력된 관광지의 추천장소" + $numberOfDays + "군데 { cityPlace : 이름(영문) } 형식으로 출력. 설명은 뺄 것.";
            contents = $city.value;
            data.push({  
                "role": "system",
                "content": systemContents,               
                "role": "user",
                "content": contents                
            })
            $tempCity = $input.value;
            $input.value = ''

            chatGPTAPI();  
            
            
        })

        function chatGPTAPI() {
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data),
                redirect: 'follow'
            })
            .then(res => res.json())
            .then(res => {
                // 로컬 스토리지에 저장 ( city, numberOfDays )
                var responseChoice = `${res.choices[0].message.content}`;
                var cityDataName = 'cityData' + $city;
                var numberOfDaysLog = 'numberOfDays' + $city;
                var cityLog = 'city' + $city;
                
                localStorage.setItem(cityDataName,responseChoice); // Log 저장용
                localStorage.setItem(cityLog, $city); // Log저장용
                localStorage.setItem(numberOfDaysName, $numberOfDays); // Log 저장용
                // 저장된 값을 파싱 
                var cityDataOriginal = localStorage.getItem(cityDataName);
                var cityData = JSON.parse(cityDataOriginal); // JsonStyle로 변경 
                // for문으로 반복하여 JSON의 배열을 변수에 입력 
                // 변수 사용시 localStorage에 담은 후 사용하도록 변경
                
                var cityPlaceNameLS = 'cityPlace' + $city; // 로컬스토리지 저장할 도시 방문장소 변수명 저장 
                
                for (let i = 0; i < 5; i++) {
                    var tempPlaceName = 'cityPlace' + $city + i;
                    localStorage.setItem(tempPlaceName, cityData[i].cityPlace) // ex 변수명 cityPlace도쿄1, 시부야
                } // 이걸로 넘어가서 지도를 만들고 메뉴를 만들고 하면됨 
                })

                // 페치가 끝나면서 로딩화면 출력
                loadingScreen();
        }

        // LocalStorage의 도시가 있다면 이걸로 구글맵 핀 5개 + 각각 사진 3개 ( API )
        
        
        // 로딩화면 함수
        function loadingScreen(){
            var loadScreen = document.querySelector('.loadingScreen');
            if ( loadScreen.style.display === 'none' ) {
                loadScreen.style.display = 'block'
            }



        }



    </script>

</body>
</html>